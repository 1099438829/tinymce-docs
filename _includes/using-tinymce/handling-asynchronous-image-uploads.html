<p>With the release of version 4.2, TinyMCE can now upload local images directly to an image handler of your choice. &nbsp;&nbsp;</p>
<p>The image uploader is designed to complement the new image editing functionality of TinyMCE 4.2. Images that are edited within TinyMCE can be uploaded using this function. Local images that are added through other means - for example drag and drop when using the <a href="/wiki.php/Configuration:paste_data_images">paste_data_images</a> configuration property or using Ephox's Power Paste Plugin - can also be uploaded using this functionality.</p>
<p>Once uploaded, TinyMCE will automatically update the &lt;image&gt; src attribute with the new path to the remote image. &nbsp;</p>
<p>Local images can be uploaded to TinyMCE through the use of the new editor.uploadImages() function. &nbsp;This functionality is handled asynchronously, meaning that it is possible for users to save their content before all images have completed uploading. &nbsp;If this occurs, no server path to the remote image will be available and the images will be stored as Base64.</p>
<p>To avoid this situation, it is recommended that the editor.uploadImages() function be executed prior to submitting the editor contents to the server. Once all images have been uploaded, a success callback can be utilized to execute code. &nbsp;This success callback can be used to save the editor's content to the server through a POST, again helping to prevent the above situation.</p>
<p>Examples of this function are below:</p>
<h5>Using uploadImages With jQuery</h5>
<pre class="js">tinymce.activeEditor.uploadImages(function(success) {<br />    $.post("ajax/post.php", tinymce.activeEditor.getContent()).done(function() {<br />        console.log("Uploaded images and posted content as an ajax request.");<br />    });<br />});</pre>
<h5>Using uploadImages and Then Posting a Form</h5>
<pre class="js">tinymce.activeEditor.uploadImages(function(success) {<br />     document.forms[0].submit();<br />});</pre>
<h3>Image Uploader Requirements</h3>
<p>In order to upload local images to the remote server, you will need a server-side upload handler script that accepts the images on the server, stores them appropriately, and returns a JSON object containing the location that they were uploaded to.</p>
<p>An example PHP upload handler implementation is available&nbsp;<a href="/wiki.php/PHP_Upload_Handler">here</a>.</p>
<p>This server-side upload handler must return a JSON object that contains a "location" property. This property should represent the remote location or filename of the newly uploaded image.</p>
<pre class="js">{ location : '/uploaded/image/path/image.png' } </pre>
<h3>Image Uploader Options</h3>
<p>There are multiple configuration options that will affect the operation of this feature. &nbsp;These options are detailed below.</p>
<p><strong>Please note, for image uploads to function correctly, either the images_upload_url or images_upload_handler options must be set.</strong></p>
<table>
<tbody>
<tr>
<td><strong>Image Upload Handling Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr>
<td><a href="/wiki.php/Configuration:images_upload_url">images_upload_url</a></td>
<td>This option lets you specify a URL to where you want images to be uploaded when you call editor.uploadImages.</td>
</tr>
<tr>
<td><a href="/wiki.php/Configuration:images_upload_base_path">images_upload_base_path</a></td>
<td>This option lets you specify a basepath to prepend to urls returned from the configured images_upload_url page.</td>
</tr>
<tr>
<td><a href="/wiki.php/Configuration:images_upload_credentials">images_upload_credentials</a></td>
<td>This option lets you specify if calls to the configured images_upload_url should pass along credentials like cookies etc cross domain. This is disabled by default.</td>
</tr>
<tr>
<td><a href="/wiki.php/Configuration:images_upload_handler">images_upload_handler</a></td>
<td>This option lets you replace TinyMCE's default javascript upload handler function with custom logic. The upload handler function takes three arguments, blobInfo, a success callback and a failure callback. When this option is not set, TinyMCE utilizes an XMLHttpRequest to upload images one at a time to the server, and calls the success callback with the location of the remote image.</td>
</tr>
</tbody>
</table>
<p>An example of a typical setup is below:</p>
<pre class="js">tinymce.init({<br />&nbsp;&nbsp;&nbsp;&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;images_upload_url: "postAcceptor.php",<br />&nbsp;&nbsp;&nbsp;&nbsp;images_upload_base_path: "/some/basepath",<br />&nbsp;&nbsp;&nbsp;&nbsp;images_upload_credentials: true<br />});
</pre>
<h3>Rolling Your Own Image Handler</h3>
<p>If the default behaviour of TinyMCE's image upload logic is not right for you, you may set your own behaviour by using the images_upload_handler configuration property.</p>
<p>Please note that while using this option, no other image uploader options are necessary. &nbsp;Additionally, if you would like TinyMCE to replace the &lt;image&gt; tag's src attribute with the remote location, please use the success callback defined in the image_upload_handler function with the returned JSON object's location property.</p>
<p>An example of this setup is below:</p>
<pre class="js">tinymce.init({<br />&nbsp;&nbsp;&nbsp;&nbsp;...<br />&nbsp;&nbsp;&nbsp;&nbsp;images_upload_handler: function (blobInfo, success, failure) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var xhr, formData;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr = new XMLHttpRequest();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.withCredentials = false;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.open('POST', "postAcceptor.php");<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.onload = function() {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var json;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (xhr.status != 200) {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failure("HTTP Error: " + xhr.status);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;json = JSON.parse(xhr.responseText);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!json || typeof json.location != "string") {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;failure("Invalid JSON: " + xhr.responseText);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;success(json.location);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formData = new FormData();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formData.append('file', blobInfo.blob(), fileName(blobInfo));<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xhr.send(formData);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />});</pre>
<h3>CORS Considerations</h3>
<p>You may choose for your web application to upload image data to a separate domain. If so, you will need to configure&nbsp;<a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing (CORS)</a>&nbsp;for your application to comply with JavaScript "same origin" restrictions.</p>
<p>CORS has very strict rules about what constitutes a cross-origin request. The browser can require CORS headers when uploading to the same server the editor is hosted on, for example:</p>
<ul>
<li>A different port on the same domain name</li>
<li>Using the host IP address instead of the domain name</li>
<li>Swapping between HTTP and HTTPS for the page and the upload script</li>
</ul>
<p>The upload script URL origin must&nbsp;<em>exactly</em>&nbsp;match the origin of the URL in the address bar, or the browser will require CORS headers to access it. A good way to guarantee this is to use a relative URL to specify the script address, instead of an absolute one.</p>
<p>All supported browsers will print a message to the JavaScript console if there is a CORS error.</p>
<p>The&nbsp;<a href="/wiki.php/PHP_Upload_Handler">PHP Upload Handler Script</a>&nbsp;provided here configures CORS in the $accepted_origins variable. You may choose to configure CORS at the&nbsp;<a href="http://www.w3.org/wiki/CORS_Enabled#At_the_Web_Application_level...">web application layer</a>&nbsp;or the&nbsp;<a href="http://www.w3.org/wiki/CORS_Enabled#At_the_HTTP_Server_level...">HTTP server layer</a>. &nbsp;</p>
<p><strong>Further Reading on CORS</strong></p>
<ul>
<li><a href="http://www.w3.org/wiki/CORS_Enabled">W3C Wiki - CORS Enabled</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">MDN - HTTP access control (CORS)</a></li>
<li><a href="http://www.w3.org/TR/cors/">W3C - Cross-Origin Resource Sharing&nbsp;</a><a href="http://www.w3.org/TR/cors/">Specification</a></li>
</ul>